<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HBL 골프 클럽 | 대시보드</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #04090f;
            --surface: rgba(16, 26, 38, 0.8);
            --panel: rgba(16, 31, 42, 0.9);
            --border: rgba(255, 255, 255, 0.06);
            --text: #e9f1f6;
            --muted: #9fb3c2;
            --accent: #4ce2b1;
            --accent-2: #6cb7ff;
            --card-shadow: 0 20px 70px rgba(0, 0, 0, 0.35);
            --radius: 18px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            min-height: 100vh;
            background:
                radial-gradient(circle at 10% 20%, rgba(76, 226, 177, 0.12), transparent 25%),
                radial-gradient(circle at 80% 0%, rgba(108, 183, 255, 0.12), transparent 28%),
                linear-gradient(160deg, #03060c 0%, #06121a 40%, #081d21 75%, #04090f 100%);
            color: var(--text);
            font-family: 'Manrope', 'Noto Sans KR', system-ui, -apple-system, sans-serif;
            padding: 0 20px 40px;
        }

        a { color: inherit; text-decoration: none; }

        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: linear-gradient(180deg, rgba(4, 9, 15, 0.9), rgba(4, 9, 15, 0.6));
            backdrop-filter: blur(14px);
            border-bottom: 1px solid var(--border);
        }

        .topbar {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .brand {
            display: inline-flex;
            align-items: center;
            gap: 12px;
        }

        .brand-mark {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: linear-gradient(135deg, #23b47e, #0f5f4f);
            display: grid;
            place-items: center;
            font-weight: 800;
            letter-spacing: -0.02em;
            color: #fff;
        }

        .brand-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .brand-text strong { font-size: 18px; letter-spacing: -0.02em; }
        .brand-text span { color: var(--muted); font-size: 12px; }

        nav {
            display: flex;
            align-items: center;
            gap: 18px;
        }

        nav a {
            padding: 10px 12px;
            border-radius: 12px;
            color: var(--muted);
            font-weight: 600;
            transition: background 0.2s ease, color 0.2s ease;
        }

        nav a.active,
        nav a:hover {
            background: rgba(255, 255, 255, 0.06);
            color: var(--text);
        }

        .ghost-btn {
            padding: 10px 14px;
            border-radius: 12px;
            border: 1px solid var(--border);
            color: var(--text);
            background: transparent;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.2s ease;
        }

        .ghost-btn:hover {
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .nav-toggle {
            display: none;
            width: 38px;
            height: 38px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.04);
            color: var(--text);
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        main {
            max-width: 1200px;
            margin: 24px auto 0;
            display: flex;
            flex-direction: column;
            gap: 22px;
        }

        .hero {
            position: relative;
            padding: clamp(20px, 3vw, 32px);
            border-radius: 26px;
            background: linear-gradient(135deg, rgba(76, 226, 177, 0.12), rgba(8, 29, 33, 0.85));
            border: 1px solid var(--border);
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        .hero::after {
            content: '';
            position: absolute;
            right: -60px;
            top: -60px;
            width: 220px;
            height: 220px;
            background: radial-gradient(circle, rgba(108, 183, 255, 0.28), transparent 55%);
            filter: blur(8px);
        }

        .hero-grid {
            display: grid;
            grid-template-columns: 1.1fr 0.9fr;
            gap: 20px;
            align-items: center;
        }

        .eyebrow {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.08);
            color: var(--muted);
            font-size: 13px;
            letter-spacing: 0.04em;
        }

        h1 {
            font-size: clamp(28px, 4vw, 38px);
            margin: 12px 0 8px;
            letter-spacing: -0.04em;
        }

        .hero p {
            color: var(--muted);
            line-height: 1.5;
            max-width: 560px;
        }

        .chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 16px 0 18px;
        }

        .chip {
            padding: 10px 12px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.08);
            color: var(--text);
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .cta-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn-primary {
            padding: 12px 16px;
            border-radius: 12px;
            background: linear-gradient(135deg, #23b47e, #0f5f4f);
            color: white;
            font-weight: 800;
            border: none;
            cursor: pointer;
            box-shadow: 0 15px 35px rgba(15, 95, 79, 0.28);
            transition: transform 0.15s ease;
        }

        .btn-primary:hover { transform: translateY(-1px); }

        .btn-ghost {
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid var(--border);
            color: var(--text);
            background: rgba(255, 255, 255, 0.04);
            font-weight: 700;
            cursor: pointer;
        }

        .mini-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 14px;
        }

        .metric-card {
            padding: 14px;
            border-radius: 14px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.04);
        }

        .metric-card span {
            display: block;
            color: var(--muted);
            font-size: 13px;
            margin-bottom: 6px;
        }

        .metric-card strong {
            font-size: 18px;
            letter-spacing: -0.02em;
        }

        .grid {
            display: grid;
            gap: 18px;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        }

        .panel {
            padding: 18px;
            border-radius: var(--radius);
            background: var(--panel);
            border: 1px solid var(--border);
            box-shadow: var(--card-shadow);
        }

        .panel-head {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }

        .panel-head h3 {
            font-size: 18px;
            letter-spacing: -0.02em;
        }

        .panel-head a {
            color: var(--muted);
            font-weight: 600;
            font-size: 13px;
        }

        .featured-news {
            position: relative;
            border-radius: 14px;
            overflow: hidden;
            min-height: 180px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border);
        }

        .featured-news img {
            width: 100%;
            height: 220px;
            object-fit: cover;
            display: block;
            filter: saturate(1.05);
        }

        .featured-news .overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, rgba(3, 6, 12, 0.25) 0%, rgba(3, 6, 12, 0.75) 100%);
            display: flex;
            align-items: flex-end;
            padding: 16px;
        }

        .featured-news .overlay p {
            color: #f5fbff;
            font-weight: 700;
            line-height: 1.4;
        }

        .news-list {
            margin-top: 12px;
            display: grid;
            gap: 10px;
        }

        .news-item {
            padding: 12px 14px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.03);
            color: var(--muted);
        }

        .round-duo {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 14px;
        }

        .round-block {
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
        }

        .round-block.secondary {
            background: linear-gradient(135deg, rgba(108, 183, 255, 0.08), rgba(4, 9, 15, 0.6));
        }

        .round-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 10px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.06);
            color: var(--text);
            font-size: 12px;
            letter-spacing: 0.02em;
            margin-bottom: 8px;
        }

        .round-details {
            display: grid;
            gap: 10px;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            margin-top: 8px;
        }

        .round-card {
            padding: 14px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.04);
        }

        .round-card label {
            color: var(--muted);
            font-size: 13px;
            margin-bottom: 6px;
            display: block;
        }

        .round-card strong {
            font-size: 17px;
            letter-spacing: -0.01em;
        }

        .leaderboard {
            display: grid;
            gap: 10px;
        }

        .leader {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.03);
        }

        .leader.top {
            background: linear-gradient(135deg, rgba(76, 226, 177, 0.18), rgba(15, 95, 79, 0.08));
        }

        .avatar {
            width: 46px;
            height: 46px;
            border-radius: 12px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.08);
        }

        .leader .name {
            font-weight: 700;
            letter-spacing: -0.01em;
        }

        .leader .meta {
            color: var(--muted);
            font-size: 13px;
            margin-top: 2px;
        }

        .leader .score {
            color: var(--accent);
            font-weight: 800;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }

        .leader .score span {
            color: var(--muted);
            font-size: 12px;
            font-weight: 600;
        }

        .status {
            color: var(--muted);
            padding: 14px;
            border-radius: 12px;
            border: 1px dashed var(--border);
            text-align: center;
            background: rgba(255, 255, 255, 0.02);
        }

        @media (max-width: 920px) {
            .hero-grid {
                grid-template-columns: 1fr;
            }

            nav {
                position: fixed;
                top: 70px;
                left: 0;
                right: 0;
                padding: 14px;
                background: rgba(4, 9, 15, 0.95);
                backdrop-filter: blur(10px);
                border-bottom: 1px solid var(--border);
                transform: translateY(-120%);
                transition: transform 0.2s ease;
                flex-wrap: wrap;
                gap: 10px;
                justify-content: center;
            }

            nav.open {
                transform: translateY(0);
            }

            .nav-toggle {
                display: inline-flex;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="topbar">
            <div class="brand">
                <div class="brand-mark">HBL</div>
                <div class="brand-text">
                    <strong>HBL Golf Club</strong>
                    <span>Members dashboard</span>
                </div>
            </div>
            <nav id="navMenu">
                <a href="main.html" class="active">대시보드</a>
                <a href="schedule.html">일정</a>
                <a href="tournament-records.html">기록</a>
                <a href="players.html">선수</a>
            </nav>
            <div style="display:flex; align-items:center; gap:10px;">
                <button class="ghost-btn" id="logoutBtn" type="button">로그아웃</button>
                <button class="nav-toggle" id="navToggle" aria-label="메뉴 열기">☰</button>
            </div>
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="hero-grid">
                <div>
                    <div class="eyebrow">2025 시즌 업데이트</div>
                    <h1>클럽 소식과 라운드를 한 눈에.</h1>
                    <p>다가오는 라운드 일정, 참가 현황, 최신 기록과 뉴스를 실시간으로 확인하세요.</p>
                    <div class="chips">
                        <span class="chip">다음 라운드 <strong id="chipDate">-</strong></span>
                        <span class="chip">티타임 <strong id="chipTime">-</strong></span>
                        <span class="chip">코스 <strong id="chipCourse">-</strong></span>
                    </div>
                    <div class="cta-row">
                        <a href="schedule.html" class="btn-primary">전체 일정 보기</a>
                        <a href="players.html" class="btn-ghost">선수 프로필</a>
                    </div>
                </div>
                <div>
                    <div class="mini-metrics" id="heroMetrics">
                        <div class="metric-card">
                            <span>참가 인원</span>
                            <strong id="metricParticipants">-</strong>
                        </div>
                        <div class="metric-card">
                            <span>라운드 날짜</span>
                            <strong id="metricDate">-</strong>
                        </div>
                        <div class="metric-card">
                            <span>코스</span>
                            <strong id="metricCourse">-</strong>
                        </div>
                        <div class="metric-card">
                            <span>티타임</span>
                            <strong id="metricTime">-</strong>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="grid">
            <article class="panel">
                <div class="panel-head">
                    <h3>최근 뉴스</h3>
                    <a href="#">더 보기</a>
                </div>
                <div id="featured-news" class="featured-news">
                    <div class="status">뉴스를 불러오는 중입니다...</div>
                </div>
                <div id="news-list" class="news-list"></div>
            </article>

            <article class="panel">
                <div class="panel-head">
                    <h3>다가오는 라운드</h3>
                    <span id="round-label" style="color:var(--muted); font-size:13px;">-</span>
                </div>
                <div class="round-duo">
                    <div class="round-block">
                        <div class="round-tag">Next</div>
                        <div class="round-details">
                            <div class="round-card">
                                <label>라운드 일시</label>
                                <strong id="round-date">-</strong>
                            </div>
                            <div class="round-card">
                                <label>티타임</label>
                                <strong id="round-time">-</strong>
                            </div>
                            <div class="round-card">
                                <label>코스</label>
                                <strong id="round-course">-</strong>
                            </div>
                            <div class="round-card">
                                <label>참가 인원</label>
                                <strong id="round-participants">-</strong>
                            </div>
                        </div>
                    </div>
                    <div class="round-block secondary">
                        <div class="round-tag">최근 라운드</div>
                        <div class="round-details">
                            <div class="round-card">
                                <label>라운드 일시</label>
                                <strong id="recent-date">-</strong>
                            </div>
                            <div class="round-card">
                                <label>티타임</label>
                                <strong id="recent-time">-</strong>
                            </div>
                            <div class="round-card">
                                <label>코스</label>
                                <strong id="recent-course">-</strong>
                            </div>
                            <div class="round-card">
                                <label>참가 인원</label>
                                <strong id="recent-participants">-</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </article>

            <article class="panel">
                <div class="panel-head">
                    <h3>리더보드</h3>
                    <a href="players.html">선수 보기</a>
                </div>
                <div id="ranking-container" class="leaderboard">
                    <div class="status">리더보드를 불러오는 중입니다...</div>
                </div>
            </article>
        </section>
    </main>

    <script>
        const API_BASE_URL = 'https://port-0-hblgolfbakend-mb4ipg5fd735a020.sel4.cloudtype.app';

        const newsFeaturedEl = document.getElementById('featured-news');
        const newsListEl = document.getElementById('news-list');
        const rankingContainer = document.getElementById('ranking-container');
        const navMenu = document.getElementById('navMenu');
        const navToggle = document.getElementById('navToggle');
        const logoutBtn = document.getElementById('logoutBtn');

        // Hero chips and metrics
        const chipDate = document.getElementById('chipDate');
        const chipTime = document.getElementById('chipTime');
        const chipCourse = document.getElementById('chipCourse');
        const metricParticipants = document.getElementById('metricParticipants');
        const metricDate = document.getElementById('metricDate');
        const metricCourse = document.getElementById('metricCourse');
        const metricTime = document.getElementById('metricTime');

        // Round panel fields
        const roundLabel = document.getElementById('round-label');
        const roundDateEl = document.getElementById('round-date');
        const roundTimeEl = document.getElementById('round-time');
        const roundCourseEl = document.getElementById('round-course');
        const roundParticipantsEl = document.getElementById('round-participants');
        const recentDateEl = document.getElementById('recent-date');
        const recentTimeEl = document.getElementById('recent-time');
        const recentCourseEl = document.getElementById('recent-course');
        const recentParticipantsEl = document.getElementById('recent-participants');

        document.addEventListener('DOMContentLoaded', () => {
            initNav();
            initLogout();
            loadNews();
            loadRounds();
            loadRankings();
        });

        function initNav() {
            navToggle?.addEventListener('click', () => {
                navMenu.classList.toggle('open');
            });

            navMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => navMenu.classList.remove('open'));
            });
        }

        function initLogout() {
            logoutBtn?.addEventListener('click', () => {
                sessionStorage.removeItem('hbl_authenticated');
                sessionStorage.removeItem('hbl_auth_time');
                window.location.href = 'index.html';
            });
        }

        async function loadNews() {
            try {
                const res = await fetch(`${API_BASE_URL}/api/news`);
                if (!res.ok) throw new Error('뉴스 로딩 실패');
                const news = await res.json();

                renderNews(news);
            } catch (err) {
                console.warn('뉴스 API 실패, fallback 사용:', err);
                renderNews(getFallbackNews());
            }
        }

        function renderNews(news) {
            if (!news || news.length === 0) {
                newsFeaturedEl.innerHTML = '<div class="status">등록된 뉴스가 없습니다.</div>';
                newsListEl.innerHTML = '';
                return;
            }

            const featured = news.find(item => item.is_featured) || news[0];
            newsFeaturedEl.innerHTML = `
                <img src="${featured.image_url || 'images/stonegate.jpg'}" alt="주요 뉴스 이미지">
                <div class="overlay"><p>${featured.title}</p></div>
            `;

            newsListEl.innerHTML = news.slice(0, 4).map(item => `
                <div class="news-item">${item.title}</div>
            `).join('');
        }

        async function loadRounds() {
            try {
                const res = await fetch(`${API_BASE_URL}/api/rounds`);
                if (!res.ok) throw new Error('라운드 로드 실패');
                const rounds = await res.json();

                const nextRound = rounds?.[0];
                const recentRound = rounds?.[1];

                if (!nextRound) {
                    applyRoundFallback();
                    return;
                }

                const [nextStats, recentStats] = await Promise.all([
                    fetch(`${API_BASE_URL}/api/rounds/${nextRound.id}/stats`).then(r => r.json()).catch(() => ({})),
                    recentRound ? fetch(`${API_BASE_URL}/api/rounds/${recentRound.id}/stats`).then(r => r.json()).catch(() => ({})) : [{}]
                ]);

                bindRound(nextRound, nextStats, recentRound, recentStats);
            } catch (err) {
                console.warn('라운드 API 실패, fallback 사용:', err);
                applyRoundFallback();
            }
        }

        function bindRound(nextRound, nextStats = {}, recentRound, recentStats = {}) {
            const nextDateText = formatDate(nextRound.round_date);
            const nextTimeText = formatTime(nextRound.tee_time);
            const nextParticipants = nextStats.participant_count ?? '-';
            const nextCourse = nextRound.course_name || '미정';

            chipDate.textContent = nextDateText;
            chipTime.textContent = nextTimeText || '미정';
            chipCourse.textContent = nextCourse;

            metricParticipants.textContent = `${nextParticipants}명`;
            metricDate.textContent = nextDateText;
            metricCourse.textContent = nextCourse;
            metricTime.textContent = nextTimeText || '미정';

            roundLabel.textContent = `${nextDateText} • ${nextCourse}`;
            roundDateEl.textContent = nextDateText;
            roundTimeEl.textContent = nextTimeText || '미정';
            roundCourseEl.textContent = nextCourse;
            roundParticipantsEl.textContent = `${nextParticipants}명`;

            if (recentRound) {
                const recentDateText = formatDate(recentRound.round_date);
                const recentTimeText = formatTime(recentRound.tee_time);
                const recentParticipants = recentStats.participant_count ?? '-';
                const recentCourse = recentRound.course_name || '미정';

                recentDateEl.textContent = recentDateText;
                recentTimeEl.textContent = recentTimeText || '미정';
                recentCourseEl.textContent = recentCourse;
                recentParticipantsEl.textContent = `${recentParticipants}명`;
            } else {
                recentDateEl.textContent = '-';
                recentTimeEl.textContent = '-';
                recentCourseEl.textContent = '-';
                recentParticipantsEl.textContent = '-';
            }
        }

        async function loadRankings() {
            try {
                const res = await fetch(`${API_BASE_URL}/api/rankings`);
                if (!res.ok) throw new Error('리더보드 로드 실패');
                const rankings = await res.json();

                renderRankings(rankings);
            } catch (err) {
                console.warn('리더보드 API 실패, fallback 사용:', err);
                renderRankings(getFallbackRankings());
            }
        }

        function renderRankings(rankings) {
            if (!rankings || rankings.length === 0) {
                rankingContainer.innerHTML = '<div class="status">랭킹 정보가 없습니다.</div>';
                return;
            }

            rankingContainer.innerHTML = rankings.slice(0, 5).map((player, idx) => `
                <div class="leader ${idx === 0 ? 'top' : ''}">
                    <img class="avatar" src="${player.photo_url || 'images/jay.png'}" alt="${player.name || 'player'}">
                    <div>
                        <div class="name">${player.name || '이름 미정'}</div>
                        <div class="meta">평균 타수 ${player.avg_score ? Math.round(player.avg_score) : 'N/A'} · 승리 ${player.wins ?? 0}회</div>
                    </div>
                    <div class="score">${player.avg_score ? Math.round(player.avg_score) : 'N/A'}<span>총 타수</span></div>
                </div>
            `).join('');
        }

        function applyRoundFallback() {
            const nextRound = {
                round_date: '2025-06-06',
                tee_time: '07:30',
                course_name: '스톤게이트 CC'
            };
            const recentRound = {
                round_date: '2025-05-11',
                tee_time: '07:40',
                course_name: '발리오스 CC'
            };
            const nextStats = { participant_count: 24 };
            const recentStats = { participant_count: 22 };
            bindRound(nextRound, nextStats, recentRound, recentStats);
        }

        function getFallbackNews() {
            return [
                { title: '스톤게이트에서 열리는 6월 정기 라운드 공지', image_url: 'images/stonegate.jpg', is_featured: true },
                { title: '핸디캡 조정 안내 및 신규 멤버 가이드' },
                { title: '5월 라운드 베스트 샷 모음' },
                { title: '여름 시즌 코스 셋업 변경 사항' }
            ];
        }

        function getFallbackRankings() {
            return [
                { name: '김종혁', photo_url: 'images/jay.png', avg_score: 99, wins: 3 },
                { name: '정인석', photo_url: 'images/suk.PNG', avg_score: 110, wins: 1 },
                { name: '김상현', photo_url: 'images/sang.jpg', avg_score: 110, wins: 1 },
                { name: '조영복', photo_url: 'images/bok2.jpg', avg_score: 113, wins: 1 },
                { name: 'Guest', photo_url: 'images/milyang.jpg', avg_score: 118, wins: 0 }
            ];
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            const weekday = ['일', '월', '화', '수', '목', '금', '토'][date.getDay()];
            return `${y}.${m}.${d} (${weekday})`;
        }

        function formatTime(timeString) {
            if (!timeString) return '';
            const [h, m] = timeString.split(':');
            return `${h}:${m}`;
        }
    </script>
</body>
</html>
