<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HBL ê³¨í”„ í´ëŸ½ - ê´€ë¦¬ì í˜ì´ì§€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .header {
            background-color: #1a75cf;
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .admin-nav {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background-color: white;
            border: 2px solid #1a75cf;
            color: #1a75cf;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .nav-btn:hover, .nav-btn.active {
            background-color: #1a75cf;
            color: white;
        }
        
        .admin-section {
            display: none;
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .admin-section.active {
            display: block;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #1a75cf;
            border-bottom: 2px solid #1a75cf;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .btn {
            background-color: #1a75cf;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #155bb5;
        }
        
        .btn-success {
            background-color: #28a745;
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-danger {
            background-color: #dc3545;
        }
        
        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }
        
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            display: none;
        }
        
        .alert-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .alert-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .player-score-entry {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }
        
        .player-score-entry h4 {
            margin-bottom: 10px;
            color: #1a75cf;
        }
        
        .score-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th,
        .data-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        .data-table th {
            background-color: #1a75cf;
            color: white;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading.show {
            display: block;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-finished {
            background-color: #28a745;
            color: white;
        }

        .status-upcoming {
            background-color: #ffc107;
            color: #212529;
        }

        .status-ongoing {
            background-color: #dc3545;
            color: white;
        }

        .round-status-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .round-status-controls select {
            min-width: 120px;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .score-inputs {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .admin-nav {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-btn {
                margin: 5px 0;
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸŒï¸â€â™‚ï¸ HBL ê³¨í”„ í´ëŸ½ ê´€ë¦¬ì í˜ì´ì§€</h1>
        <p>ë¼ìš´ë”© ê¸°ë¡ì„ ì‰½ê²Œ ê´€ë¦¬í•˜ì„¸ìš”</p>
    </div>
    
    <div class="container">
        <div class="admin-nav">
            <button class="nav-btn active" onclick="showSection('add-round')">ìƒˆ ë¼ìš´ë”© ì¶”ê°€</button>
            <button class="nav-btn" onclick="showSection('add-scores')">ìŠ¤ì½”ì–´ ì…ë ¥</button>
            <button class="nav-btn" onclick="showSection('manage-rounds')">ë¼ìš´ë”© ê´€ë¦¬</button>
            <button class="nav-btn" onclick="showSection('add-course')">ê³¨í”„ì¥ ì¶”ê°€</button>
            <button class="nav-btn" onclick="showSection('add-news')">ë‰´ìŠ¤ ì¶”ê°€</button>
            <button class="nav-btn" onclick="showSection('view-data')">ë°ì´í„° ì¡°íšŒ</button>
        </div>
        
        <!-- ìƒˆ ë¼ìš´ë”© ì¶”ê°€ ì„¹ì…˜ -->
        <div id="add-round" class="admin-section active">
            <h2 class="section-title">ìƒˆ ë¼ìš´ë”© ì¶”ê°€</h2>
            
            <div class="alert alert-success" id="round-success-alert"></div>
            <div class="alert alert-error" id="round-error-alert"></div>
            
            <form id="round-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="round-name">ë¼ìš´ë”©ëª…</label>
                        <input type="text" id="round-name" name="round_name" placeholder="ì˜ˆ: ìŠ¤í†¤ê²Œì´íŠ¸CC ë¼ìš´ë”©" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="round-date">ë¼ìš´ë”© ë‚ ì§œ</label>
                        <input type="date" id="round-date" name="round_date" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="course-select">ê³¨í”„ì¥</label>
                        <select id="course-select" name="course_id" required>
                            <option value="">ê³¨í”„ì¥ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="tee-time">í‹°ì˜¤í”„ ì‹œê°„</label>
                        <input type="time" id="tee-time" name="tee_time">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="weather">ë‚ ì”¨</label>
                        <select id="weather" name="weather">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ë§‘ìŒ">ë§‘ìŒ</option>
                            <option value="íë¦¼">íë¦¼</option>
                            <option value="ë¹„">ë¹„</option>
                            <option value="ëˆˆ">ëˆˆ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="temperature">ê¸°ì˜¨ (Â°C)</label>
                        <input type="number" id="temperature" name="temperature" placeholder="24">
                    </div>
                    
                    <div class="form-group">
                        <label for="wind-condition">ë°”ëŒ</label>
                        <select id="wind-condition" name="wind_condition">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì•½í•¨">ì•½í•¨</option>
                            <option value="ë³´í†µ">ë³´í†µ</option>
                            <option value="ê°•í•¨">ê°•í•¨</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="round-time">ë¼ìš´ë”© ì‹œê°„</label>
                        <input type="text" id="round-time" name="round_time" placeholder="4ì‹œê°„ 30ë¶„">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="prize-money">ìƒê¸ˆ</label>
                    <input type="text" id="prize-money" name="prize_money" placeholder="1000ì›ë¹µ">
                </div>
                
                <button type="submit" class="btn">ë¼ìš´ë”© ì¶”ê°€</button>
            </form>
        </div>
        
        <!-- ìŠ¤ì½”ì–´ ì…ë ¥ ì„¹ì…˜ -->
        <div id="add-scores" class="admin-section">
            <h2 class="section-title">ìŠ¤ì½”ì–´ ì…ë ¥</h2>
            
            <div class="alert alert-success" id="score-success-alert"></div>
            <div class="alert alert-error" id="score-error-alert"></div>
            
            <div class="form-group">
                <label for="score-round-select">ë¼ìš´ë”© ì„ íƒ</label>
                <select id="score-round-select" required>
                    <option value="">ë¼ìš´ë”©ì„ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
            </div>
            
            <div id="player-scores-container">
                <!-- ì„ ìˆ˜ë³„ ìŠ¤ì½”ì–´ ì…ë ¥ í¼ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
            
            <button type="button" class="btn" onclick="saveAllScores()">ëª¨ë“  ìŠ¤ì½”ì–´ ì €ì¥</button>
        </div>

        <!-- ë¼ìš´ë”© ê´€ë¦¬ ì„¹ì…˜ (ìƒˆë¡œ ì¶”ê°€) -->
        <div id="manage-rounds" class="admin-section">
            <h2 class="section-title">ë¼ìš´ë”© ê´€ë¦¬</h2>
            
            <div class="alert alert-success" id="manage-success-alert"></div>
            <div class="alert alert-error" id="manage-error-alert"></div>

            <div style="margin-bottom: 20px;">
                <button class="btn btn-warning" onclick="updateAllRoundsToFinished()">ëª¨ë“  ë¼ìš´ë”©ì„ ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½</button>
            </div>
            
            <table class="data-table" id="rounds-manage-table">
                <thead>
                    <tr>
                        <th>ë‚ ì§œ</th>
                        <th>ë¼ìš´ë”©ëª…</th>
                        <th>ê³¨í”„ì¥</th>
                        <th>ìƒíƒœ</th>
                        <th>ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
                </tbody>
            </table>
        </div>
        
        <!-- ê³¨í”„ì¥ ì¶”ê°€ ì„¹ì…˜ -->
        <div id="add-course" class="admin-section">
            <h2 class="section-title">ê³¨í”„ì¥ ì¶”ê°€</h2>
            
            <div class="alert alert-success" id="course-success-alert"></div>
            <div class="alert alert-error" id="course-error-alert"></div>
            
            <form id="course-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="course-name">ê³¨í”„ì¥ëª…</label>
                        <input type="text" id="course-name" name="name" placeholder="ìŠ¤í†¤ê²Œì´íŠ¸CC" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="course-location">ìœ„ì¹˜</label>
                        <input type="text" id="course-location" name="location" placeholder="ê²½ê¸°ë„">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="course-type">ì½”ìŠ¤ íƒ€ì…</label>
                        <input type="text" id="course-type" name="course_type" placeholder="18í™€">
                    </div>
                    
                    <div class="form-group">
                        <label for="course-par">íŒŒ</label>
                        <input type="number" id="course-par" name="par" placeholder="72">
                    </div>
                    
                    <div class="form-group">
                        <label for="course-yardage">ì•¼ë“œ</label>
                        <input type="number" id="course-yardage" name="yardage" placeholder="6800">
                    </div>
                </div>
                
                <button type="submit" class="btn">ê³¨í”„ì¥ ì¶”ê°€</button>
            </form>
        </div>
        
        <!-- ë‰´ìŠ¤ ì¶”ê°€ ì„¹ì…˜ -->
        <div id="add-news" class="admin-section">
            <h2 class="section-title">ë‰´ìŠ¤ ì¶”ê°€</h2>
            
            <div class="alert alert-success" id="news-success-alert"></div>
            <div class="alert alert-error" id="news-error-alert"></div>
            
            <form id="news-form">
                <div class="form-group">
                    <label for="news-title">ì œëª©</label>
                    <input type="text" id="news-title" name="title" placeholder="ë‰´ìŠ¤ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                
                <div class="form-group">
                    <label for="news-content">ë‚´ìš©</label>
                    <textarea id="news-content" name="content" placeholder="ë‰´ìŠ¤ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="news-image">ì´ë¯¸ì§€ URL</label>
                        <input type="url" id="news-image" name="image_url" placeholder="https://example.com/image.jpg">
                    </div>
                    
                    <div class="form-group">
                        <label for="news-round">ê´€ë ¨ ë¼ìš´ë”©</label>
                        <select id="news-round" name="round_id">
                            <option value="">ê´€ë ¨ ë¼ìš´ë”©ì„ ì„ íƒí•˜ì„¸ìš” (ì„ íƒì‚¬í•­)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="news-featured" name="is_featured">
                        ì¤‘ìš” ë‰´ìŠ¤ë¡œ í‘œì‹œ
                    </label>
                </div>
                
                <button type="submit" class="btn">ë‰´ìŠ¤ ì¶”ê°€</button>
            </form>
        </div>
        
        <!-- ë°ì´í„° ì¡°íšŒ ì„¹ì…˜ -->
        <div id="view-data" class="admin-section">
            <h2 class="section-title">ë°ì´í„° ì¡°íšŒ</h2>
            
            <div class="loading" id="data-loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            
            <h3>ìµœê·¼ ë¼ìš´ë”© ê¸°ë¡</h3>
            <table class="data-table" id="rounds-table">
                <thead>
                    <tr>
                        <th>ë‚ ì§œ</th>
                        <th>ë¼ìš´ë”©ëª…</th>
                        <th>ê³¨í”„ì¥</th>
                        <th>ìš°ìŠ¹ì</th>
                        <th>ìƒíƒœ</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
                </tbody>
            </table>
            
            <h3 style="margin-top: 30px;">ì„ ìˆ˜ ë­í‚¹</h3>
            <table class="data-table" id="rankings-table">
                <thead>
                    <tr>
                        <th>ìˆœìœ„</th>
                        <th>ì„ ìˆ˜ëª…</th>
                        <th>í‰ê·  ìŠ¤ì½”ì–´</th>
                        <th>ë² ìŠ¤íŠ¸ ìŠ¤ì½”ì–´</th>
                        <th>ìš°ìŠ¹ íšŸìˆ˜</th>
                        <th>TOP3</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        const API_BASE_URL = 'https://port-0-hblgolfbakend-mb4ipg5fd735a020.sel4.cloudtype.app';
        
        // ì„¹ì…˜ ì „í™˜ í•¨ìˆ˜
        function showSection(sectionId) {
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            const sections = document.querySelectorAll('.admin-section');
            sections.forEach(section => section.classList.remove('active'));
            
            // ëª¨ë“  ë„¤ë¹„ ë²„íŠ¼ ë¹„í™œì„±í™”
            const navBtns = document.querySelectorAll('.nav-btn');
            navBtns.forEach(btn => btn.classList.remove('active'));
            
            // ì„ íƒëœ ì„¹ì…˜ í‘œì‹œ
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
            
            // ì„¹ì…˜ë³„ ì´ˆê¸°í™”
            if (sectionId === 'add-round') {
                loadCourses();
            } else if (sectionId === 'add-scores') {
                loadRoundsForScore();
            } else if (sectionId === 'add-news') {
                loadRoundsForNews();
            } else if (sectionId === 'manage-rounds') {
                loadRoundsForManagement();
            } else if (sectionId === 'view-data') {
                loadAllData();
            }
        }
        
        // ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
        function showAlert(alertId, message, isSuccess = true) {
            const alert = document.getElementById(alertId);
            alert.textContent = message;
            alert.className = isSuccess ? 'alert alert-success' : 'alert alert-error';
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }
        
        // ê³¨í”„ì¥ ëª©ë¡ ë¡œë“œ
        async function loadCourses() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/courses`);
                const courses = await response.json();
                
                const select = document.getElementById('course-select');
                select.innerHTML = '<option value="">ê³¨í”„ì¥ì„ ì„ íƒí•˜ì„¸ìš”</option>';
                
                courses.forEach(course => {
                    const option = document.createElement('option');
                    option.value = course.id;
                    option.textContent = `${course.name} (${course.location})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('ê³¨í”„ì¥ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ìŠ¤ì½”ì–´ ì…ë ¥ìš© ë¼ìš´ë”© ëª©ë¡ ë¡œë“œ
        async function loadRoundsForScore() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/rounds`);
                const rounds = await response.json();
                
                const select = document.getElementById('score-round-select');
                select.innerHTML = '<option value="">ë¼ìš´ë”©ì„ ì„ íƒí•˜ì„¸ìš”</option>';
                
                rounds.forEach(round => {
                    const option = document.createElement('option');
                    option.value = round.id;
                    option.textContent = `${round.round_name} (${round.round_date})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('ë¼ìš´ë”© ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ë‰´ìŠ¤ìš© ë¼ìš´ë”© ëª©ë¡ ë¡œë“œ
        async function loadRoundsForNews() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/rounds`);
                const rounds = await response.json();
                
                const select = document.getElementById('news-round');
                select.innerHTML = '<option value="">ê´€ë ¨ ë¼ìš´ë”©ì„ ì„ íƒí•˜ì„¸ìš” (ì„ íƒì‚¬í•­)</option>';
                
                rounds.forEach(round => {
                    const option = document.createElement('option');
                    option.value = round.id;
                    option.textContent = `${round.round_name} (${round.round_date})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('ë¼ìš´ë”© ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ë¼ìš´ë”© ê´€ë¦¬ìš© ëª©ë¡ ë¡œë“œ (ìƒˆë¡œ ì¶”ê°€)
        async function loadRoundsForManagement() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/rounds`);
                const rounds = await response.json();
                
                const tbody = document.querySelector('#rounds-manage-table tbody');
                tbody.innerHTML = '';
                
                rounds.forEach(round => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${round.round_date}</td>
                        <td>${round.round_name}</td>
                        <td>${round.course_name || 'ë¯¸ì§€ì •'}</td>
                        <td>
                            <span class="status-badge status-${round.status}">${getStatusText(round.status)}</span>
                        </td>
                        <td>
                            <div class="round-status-controls">
                                <select onchange="updateRoundStatus(${round.id}, this.value)">
                                    <option value="upcoming" ${round.status === 'upcoming' ? 'selected' : ''}>ì˜ˆì •</option>
                                    <option value="ongoing" ${round.status === 'ongoing' ? 'selected' : ''}>ì§„í–‰ì¤‘</option>
                                    <option value="finished" ${round.status === 'finished' ? 'selected' : ''}>ì™„ë£Œ</option>
                                </select>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('ë¼ìš´ë”© ê´€ë¦¬ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ìƒíƒœ í…ìŠ¤íŠ¸ ë³€í™˜
        function getStatusText(status) {
            const statusMap = {
                'upcoming': 'ì˜ˆì •',
                'ongoing': 'ì§„í–‰ì¤‘',
                'finished': 'ì™„ë£Œ'
            };
            return statusMap[status] || status;
        }

        // ë¼ìš´ë”© ìƒíƒœ ì—…ë°ì´íŠ¸ (ìƒˆë¡œ ì¶”ê°€)
        async function updateRoundStatus(roundId, newStatus) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/rounds/${roundId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: newStatus })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('manage-success-alert', `ë¼ìš´ë”© ìƒíƒœê°€ "${getStatusText(newStatus)}"ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    // ìƒíƒœ ë°°ì§€ ì—…ë°ì´íŠ¸
                    loadRoundsForManagement();
                } else {
                    showAlert('manage-error-alert', result.error, false);
                }
            } catch (error) {
                console.error('ë¼ìš´ë”© ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                showAlert('manage-error-alert', 'ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', false);
            }
        }

        // ëª¨ë“  ë¼ìš´ë”©ì„ ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½ (ìƒˆë¡œ ì¶”ê°€)
        async function updateAllRoundsToFinished() {
            try {
                // ëª¨ë“  ë¼ìš´ë”© ê°€ì ¸ì˜¤ê¸°
                const response = await fetch(`${API_BASE_URL}/api/rounds`);
                const rounds = await response.json();
                
                let updatedCount = 0;
                
                // ê° ë¼ìš´ë”©ì˜ ìƒíƒœë¥¼ finishedë¡œ ì—…ë°ì´íŠ¸
                for (const round of rounds) {
                    if (round.status !== 'finished') {
                        const updateResponse = await fetch(`${API_BASE_URL}/api/admin/rounds/${round.id}/status`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ status: 'finished' })
                        });
                        
                        if (updateResponse.ok) {
                            updatedCount++;
                        }
                    }
                }
                
                if (updatedCount > 0) {
                    showAlert('manage-success-alert', `${updatedCount}ê°œì˜ ë¼ìš´ë”©ì´ ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    loadRoundsForManagement(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else {
                    showAlert('manage-success-alert', 'ëª¨ë“  ë¼ìš´ë”©ì´ ì´ë¯¸ ì™„ë£Œ ìƒíƒœì…ë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('ì¼ê´„ ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                showAlert('manage-error-alert', 'ì¼ê´„ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', false);
            }
        }
        
        // ì„ ìˆ˜ë³„ ìŠ¤ì½”ì–´ ì…ë ¥ í¼ ìƒì„±
        async function createPlayerScoreForms(roundId) {
            try {
                const playersResponse = await fetch(`${API_BASE_URL}/api/players`);
                const players = await playersResponse.json();
                
                const container = document.getElementById('player-scores-container');
                container.innerHTML = '';
                
                players.forEach((player, index) => {
                    const playerDiv = document.createElement('div');
                    playerDiv.className = 'player-score-entry';
                    playerDiv.innerHTML = `
                        <h4>${player.name}</h4>
                        <div class="score-inputs">
                            <div class="form-group">
                                <label>ì´ ìŠ¤ì½”ì–´</label>
                                <input type="number" name="total_score_${player.id}" placeholder="100" required>
                            </div>
                            <div class="form-group">
                                <label>ìˆœìœ„</label>
                                <input type="number" name="ranking_${player.id}" placeholder="${index + 1}" required>
                            </div>
                            <div class="form-group">
                                <label>ë²„ë””</label>
                                <input type="number" name="birdie_count_${player.id}" placeholder="0" min="0">
                            </div>
                            <div class="form-group">
                                <label>ì´ê¸€</label>
                                <input type="number" name="eagle_count_${player.id}" placeholder="0" min="0">
                            </div>
                            <div class="form-group">
                                <label>ë‹ˆì–´ë¦¬ìŠ¤íŠ¸</label>
                                <input type="number" name="nearest_count_${player.id}" placeholder="0" min="0">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ë©”ëª¨</label>
                            <textarea name="notes_${player.id}" placeholder="íŠ¹ë³„í•œ ê¸°ë¡ì´ë‚˜ ë©”ëª¨"></textarea>
                        </div>
                    `;
                    container.appendChild(playerDiv);
                });
            } catch (error) {
                console.error('ì„ ìˆ˜ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ë¼ìš´ë”© ì„ íƒ ì‹œ ìŠ¤ì½”ì–´ í¼ ìƒì„±
        document.getElementById('score-round-select').addEventListener('change', function() {
            if (this.value) {
                createPlayerScoreForms(this.value);
            } else {
                document.getElementById('player-scores-container').innerHTML = '';
            }
        });
        
        // ëª¨ë“  ìŠ¤ì½”ì–´ ì €ì¥
        async function saveAllScores() {
            const roundId = document.getElementById('score-round-select').value;
            if (!roundId) {
                showAlert('score-error-alert', 'ë¼ìš´ë”©ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.', false);
                return;
            }
            
            try {
                const playersResponse = await fetch(`${API_BASE_URL}/api/players`);
                const players = await playersResponse.json();
                
                const scores = [];
                let hasError = false;
                
                players.forEach(player => {
                    const totalScore = document.querySelector(`input[name="total_score_${player.id}"]`);
                    const ranking = document.querySelector(`input[name="ranking_${player.id}"]`);
                    
                    if (totalScore && totalScore.value && ranking && ranking.value) {
                        scores.push({
                            round_id: parseInt(roundId),
                            player_id: player.id,
                            total_score: parseInt(totalScore.value),
                            ranking: parseInt(ranking.value),
                            birdie_count: parseInt(document.querySelector(`input[name="birdie_count_${player.id}"]`).value) || 0,
                            eagle_count: parseInt(document.querySelector(`input[name="eagle_count_${player.id}"]`).value) || 0,
                            nearest_count: parseInt(document.querySelector(`input[name="nearest_count_${player.id}"]`).value) || 0,
                            notes: document.querySelector(`textarea[name="notes_${player.id}"]`).value || ''
                        });
                    }
                });
                
                if (scores.length === 0) {
                    showAlert('score-error-alert', 'ìµœì†Œ í•œ ëª…ì˜ ì„ ìˆ˜ ìŠ¤ì½”ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', false);
                    return;
                }
                
                // ëª¨ë“  ìŠ¤ì½”ì–´ ì €ì¥
                for (const score of scores) {
                    const response = await fetch(`${API_BASE_URL}/api/admin/scores`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(score)
                    });
                    
                    if (!response.ok) {
                        hasError = true;
                        break;
                    }
                }
                
                if (!hasError) {
                    showAlert('score-success-alert', 'ëª¨ë“  ìŠ¤ì½”ì–´ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    document.getElementById('player-scores-container').innerHTML = '';
                    document.getElementById('score-round-select').value = '';
                } else {
                    showAlert('score-error-alert', 'ìŠ¤ì½”ì–´ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', false);
                }
                
            } catch (error) {
                console.error('ìŠ¤ì½”ì–´ ì €ì¥ ì˜¤ë¥˜:', error);
                showAlert('score-error-alert', 'ìŠ¤ì½”ì–´ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', false);
            }
        }
        
        // ëª¨ë“  ë°ì´í„° ë¡œë“œ
        async function loadAllData() {
            const loading = document.getElementById('data-loading');
            loading.classList.add('show');
            
            try {
                // ë¼ìš´ë”© ë°ì´í„° ë¡œë“œ
                const roundsResponse = await fetch(`${API_BASE_URL}/api/rounds`);
                const rounds = await roundsResponse.json();
                
                const roundsTableBody = document.querySelector('#rounds-table tbody');
                roundsTableBody.innerHTML = '';
                
                rounds.forEach(round => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${round.round_date}</td>
                        <td>${round.round_name}</td>
                        <td>${round.course_name || 'ë¯¸ì§€ì •'}</td>
                        <td>${round.winner_name || 'ë¯¸ì •'} ${round.winner_score ? `(${round.winner_score}íƒ€)` : ''}</td>
                        <td><span class="status-badge status-${round.status}">${getStatusText(round.status)}</span></td>
                    `;
                    roundsTableBody.appendChild(row);
                });
                
                // ë­í‚¹ ë°ì´í„° ë¡œë“œ
                const rankingsResponse = await fetch(`${API_BASE_URL}/api/rankings`);
                const rankings = await rankingsResponse.json();
                
                const rankingsTableBody = document.querySelector('#rankings-table tbody');
                rankingsTableBody.innerHTML = '';
                
                rankings.forEach((player, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${player.name}</td>
                        <td>${player.avg_score ? player.avg_score.toFixed(1) : 'N/A'}</td>
                        <td>${player.best_score || 'N/A'}</td>
                        <td>${player.wins || 0}</td>
                        <td>${player.top3 || 0}</td>
                    `;
                    rankingsTableBody.appendChild(row);
                });
                
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
            } finally {
                loading.classList.remove('show');
            }
        }
        
        // í¼ ì œì¶œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        
        // ë¼ìš´ë”© ì¶”ê°€ í¼
        document.getElementById('round-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/rounds`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('round-success-alert', result.message);
                    this.reset();
                } else {
                    showAlert('round-error-alert', result.error, false);
                }
            } catch (error) {
                console.error('ë¼ìš´ë”© ì¶”ê°€ ì˜¤ë¥˜:', error);
                showAlert('round-error-alert', 'ë¼ìš´ë”© ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', false);
            }
        });
        
        // ê³¨í”„ì¥ ì¶”ê°€ í¼
        document.getElementById('course-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/courses`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('course-success-alert', result.message);
                    this.reset();
                } else {
                    showAlert('course-error-alert', result.error, false);
                }
            } catch (error) {
                console.error('ê³¨í”„ì¥ ì¶”ê°€ ì˜¤ë¥˜:', error);
                showAlert('course-error-alert', 'ê³¨í”„ì¥ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', false);
            }
        });
        
        // ë‰´ìŠ¤ ì¶”ê°€ í¼
        document.getElementById('news-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());
            data.is_featured = document.getElementById('news-featured').checked;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/news`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('news-success-alert', result.message);
                    this.reset();
                } else {
                    showAlert('news-error-alert', result.error, false);
                }
            } catch (error) {
                console.error('ë‰´ìŠ¤ ì¶”ê°€ ì˜¤ë¥˜:', error);
                showAlert('news-error-alert', 'ë‰´ìŠ¤ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', false);
            }
        });
        
        // ì´ˆê¸° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            loadCourses();
        });
    </script>
</body>
</html>